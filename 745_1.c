static char* Ascii85Encode(unsigned char* raw) { static char encoded[6]; uint32 word; word = (((raw[0]<<8)+raw[1])<<16) + (raw[2]<<8) + raw[3]; if (word != 0L) { uint32 q; uint16 w1; q = word / (85L*85*85*85); encoded[0] = (char) (q + '!'); word -= q * (85L*85*85*85); q = word / (85L*85*85); encoded[1] = (char) (q + '!'); word -= q * (85L*85*85); q = word / (85*85); encoded[2] = (char) (q + '!'); w1 = (uint16) (word - q*(85L*85)); encoded[3] = (char) ((w1 / 85) + '!'); encoded[4] = (char) ((w1 % 85) + '!'); } else encoded[0] = 'z'; return (encoded); }